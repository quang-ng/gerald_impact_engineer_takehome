{
  "title": "Gerald BNPL Decision Service",
  "description": "Business metrics for Product/Finance and engineering metrics for SRE/On-call teams.",
  "layout_type": "ordered",
  "tags": ["team:gerald"],
  "widgets": [
    {
      "definition": {
        "title": "BUSINESS VIEW - Product & Finance",
        "type": "group",
        "background_color": "vivid_blue",
        "layout_type": "ordered",
        "widgets": [
          {
            "definition": {
              "type": "timeseries",
              "title": "Approval Rate Trend",
              "requests": [
                {
                  "formulas": [{"alias": "Approval Rate %", "formula": "query1"}],
                  "queries": [{"name": "query1", "data_source": "metrics", "query": "avg:gerald.gerald_approval_rate_1h{*}"}],
                  "response_format": "timeseries",
                  "display_type": "line"
                }
              ],
              "yaxis": {"min": "0", "max": "100"}
            }
          },
          {
            "definition": {
              "type": "toplist",
              "title": "Decisions by Score Band",
              "requests": [
                {
                  "formulas": [{"formula": "query1", "limit": {"count": 10, "order": "desc"}}],
                  "queries": [{"name": "query1", "data_source": "metrics", "query": "sum:gerald.gerald_decision_by_score_band.count{*} by {score_band}", "aggregator": "sum"}],
                  "response_format": "scalar"
                }
              ]
            }
          },
          {
            "definition": {
              "type": "timeseries",
              "title": "Decision Volume by Outcome",
              "requests": [
                {
                  "formulas": [{"alias": "Decisions", "formula": "query1"}],
                  "queries": [{"name": "query1", "data_source": "metrics", "query": "sum:gerald.gerald_decision.count{*} by {outcome}"}],
                  "response_format": "timeseries",
                  "display_type": "bars"
                }
              ]
            }
          },
          {
            "definition": {
              "type": "timeseries",
              "title": "Average Credit Limit ($)",
              "requests": [
                {
                  "formulas": [{"alias": "Avg Credit Limit", "formula": "query1"}],
                  "queries": [{"name": "query1", "data_source": "metrics", "query": "avg:gerald.gerald_avg_credit_limit_dollars{*}"}],
                  "response_format": "timeseries",
                  "display_type": "line"
                }
              ]
            }
          },
          {
            "definition": {
              "type": "timeseries",
              "title": "Credit Limit Buckets Over Time",
              "requests": [
                {
                  "formulas": [{"alias": "Limits", "formula": "query1"}],
                  "queries": [{"name": "query1", "data_source": "metrics", "query": "sum:gerald.gerald_credit_limit_bucket.count{*} by {bucket}"}],
                  "response_format": "timeseries",
                  "display_type": "bars"
                }
              ]
            }
          },
          {
            "definition": {
              "type": "query_value",
              "title": "Total Decisions",
              "autoscale": true,
              "precision": 0,
              "requests": [
                {
                  "formulas": [{"formula": "query1"}],
                  "queries": [{"name": "query1", "data_source": "metrics", "query": "sum:gerald.gerald_decision.count{*}", "aggregator": "sum"}],
                  "response_format": "scalar"
                }
              ]
            }
          },
          {
            "definition": {
              "type": "query_value",
              "title": "Approval Rate",
              "autoscale": false,
              "precision": 1,
              "requests": [
                {
                  "formulas": [{"formula": "query1 * 100"}],
                  "queries": [{"name": "query1", "data_source": "metrics", "query": "avg:gerald.gerald_approval_rate_1h{*}", "aggregator": "last"}],
                  "response_format": "scalar",
                  "conditional_formats": [
                    {"comparator": ">=", "value": 50, "palette": "white_on_green"},
                    {"comparator": ">=", "value": 30, "palette": "white_on_yellow"},
                    {"comparator": "<", "value": 30, "palette": "white_on_red"}
                  ]
                }
              ],
              "custom_unit": "%"
            }
          },
          {
            "definition": {
              "type": "query_value",
              "title": "Avg Credit Limit",
              "autoscale": false,
              "precision": 0,
              "requests": [
                {
                  "formulas": [{"formula": "query1"}],
                  "queries": [{"name": "query1", "data_source": "metrics", "query": "avg:gerald.gerald_avg_credit_limit_dollars{*}", "aggregator": "last"}],
                  "response_format": "scalar"
                }
              ],
              "custom_unit": "$"
            }
          }
        ]
      }
    },
    {
      "definition": {
        "title": "ENGINEERING VIEW - SRE & On-call",
        "type": "group",
        "background_color": "vivid_orange",
        "layout_type": "ordered",
        "widgets": [
          {
            "definition": {
              "type": "timeseries",
              "title": "Decision Latency (avg seconds)",
              "requests": [
                {
                  "formulas": [{"alias": "Avg Latency", "formula": "query1 / query2"}],
                  "queries": [
                    {"name": "query1", "data_source": "metrics", "query": "sum:gerald.decision_latency_seconds.sum{*}"},
                    {"name": "query2", "data_source": "metrics", "query": "sum:gerald.decision_latency_seconds.count{*}"}
                  ],
                  "response_format": "timeseries",
                  "display_type": "line"
                }
              ],
              "markers": [
                {"value": "y = 1", "display_type": "warning dashed", "label": "SLO: 1s"},
                {"value": "y = 2", "display_type": "error dashed", "label": "Critical: 2s"}
              ]
            }
          },
          {
            "definition": {
              "type": "timeseries",
              "title": "HTTP Requests by Status Code",
              "requests": [
                {
                  "formulas": [{"alias": "Requests", "formula": "query1"}],
                  "queries": [{"name": "query1", "data_source": "metrics", "query": "sum:gerald.http_requests.count{*} by {status}"}],
                  "response_format": "timeseries",
                  "display_type": "bars"
                }
              ]
            }
          },
          {
            "definition": {
              "type": "timeseries",
              "title": "HTTP Request Duration (avg seconds by endpoint)",
              "requests": [
                {
                  "formulas": [{"alias": "Avg Duration", "formula": "query1 / query2"}],
                  "queries": [
                    {"name": "query1", "data_source": "metrics", "query": "sum:gerald.http_request_duration_seconds.sum{*} by {endpoint}"},
                    {"name": "query2", "data_source": "metrics", "query": "sum:gerald.http_request_duration_seconds.count{*} by {endpoint}"}
                  ],
                  "response_format": "timeseries",
                  "display_type": "line"
                }
              ]
            }
          },
          {
            "definition": {
              "type": "timeseries",
              "title": "Bank API Fetches",
              "requests": [
                {
                  "formulas": [{"alias": "Success", "formula": "query1"}],
                  "queries": [{"name": "query1", "data_source": "metrics", "query": "sum:gerald.gerald_bank_fetch_success.count{*}"}],
                  "response_format": "timeseries",
                  "display_type": "bars"
                }
              ]
            }
          },
          {
            "definition": {
              "type": "timeseries",
              "title": "Bank API Latency (avg seconds)",
              "requests": [
                {
                  "formulas": [{"alias": "Avg Latency", "formula": "query1 / query2"}],
                  "queries": [
                    {"name": "query1", "data_source": "metrics", "query": "sum:gerald.gerald_bank_fetch_latency_seconds.sum{*}"},
                    {"name": "query2", "data_source": "metrics", "query": "sum:gerald.gerald_bank_fetch_latency_seconds.count{*}"}
                  ],
                  "response_format": "timeseries",
                  "display_type": "line"
                }
              ]
            }
          },
          {
            "definition": {
              "type": "timeseries",
              "title": "Webhook Delivery by Outcome",
              "requests": [
                {
                  "formulas": [{"alias": "Webhooks", "formula": "query1"}],
                  "queries": [{"name": "query1", "data_source": "metrics", "query": "sum:gerald.gerald_webhook_delivery.count{*} by {status}"}],
                  "response_format": "timeseries",
                  "display_type": "bars"
                }
              ]
            }
          },
          {
            "definition": {
              "type": "timeseries",
              "title": "Webhook Queue Depth",
              "requests": [
                {
                  "formulas": [{"alias": "Queue Depth", "formula": "query1"}],
                  "queries": [{"name": "query1", "data_source": "metrics", "query": "avg:gerald.webhook_queue_depth{*}"}],
                  "response_format": "timeseries",
                  "display_type": "line"
                }
              ],
              "markers": [{"value": "y = 100", "display_type": "error dashed", "label": "Alert: 100"}]
            }
          },
          {
            "definition": {
              "type": "timeseries",
              "title": "Request Rate (per second)",
              "requests": [
                {
                  "formulas": [{"alias": "Requests/s", "formula": "query1"}],
                  "queries": [{"name": "query1", "data_source": "metrics", "query": "sum:gerald.http_requests.count{*}.as_rate()"}],
                  "response_format": "timeseries",
                  "display_type": "line"
                }
              ]
            }
          },
          {
            "definition": {
              "type": "query_value",
              "title": "Total HTTP Requests",
              "autoscale": true,
              "precision": 0,
              "requests": [
                {
                  "formulas": [{"formula": "query1"}],
                  "queries": [{"name": "query1", "data_source": "metrics", "query": "sum:gerald.http_requests.count{*}", "aggregator": "sum"}],
                  "response_format": "scalar"
                }
              ]
            }
          },
          {
            "definition": {
              "type": "query_value",
              "title": "Bank API Success Count",
              "precision": 0,
              "requests": [
                {
                  "formulas": [{"formula": "query1"}],
                  "queries": [{"name": "query1", "data_source": "metrics", "query": "sum:gerald.gerald_bank_fetch_success.count{*}", "aggregator": "sum"}],
                  "response_format": "scalar"
                }
              ]
            }
          }
        ]
      }
    }
  ]
}
